<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صندوق الحكمة - شارك النصيحة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #25D366; /* لون واتساب */
            --secondary: #128C7E;
            --light: #f8f9fa;
            --dark: #343a40;
            --white: #ffffff;
            --info: #17a2b8;
        }
        
        body {
            font-family: 'Tajawal', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: var(--dark);
        }
        
        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 0 15px;
        }
        
        .card {
            background: var(--white);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 700;
        }
        
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 16px;
        }
        
        .header i {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 40px;
            opacity: 0.2;
        }
        
        .info-box {
            background-color: #e7f8ff;
            border-right: 4px solid var(--info);
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 15px;
        }
        
        .info-box i {
            color: var(--info);
            margin-left: 8px;
        }
        
        .form-body {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 211, 102, 0.2);
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }
        
        .btn i {
            margin-left: 8px;
        }
        
        #status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .loading {
            background-color: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }
        
        .whatsapp-float {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 100;
        }
        
        .whatsapp-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 50%;
            box-shadow: 0 4px 20px rgba(37, 211, 102, 0.3);
            font-size: 30px;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .whatsapp-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(37, 211, 102, 0.4);
        }
        
        /* قسم العداد التنازلي */
        .countdown-container {
            display: none;
            padding: 25px;
            text-align: center;
        }
        
        .countdown-container h2 {
            color: var(--secondary);
            margin-bottom: 20px;
        }
        
        .countdown {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        
        .countdown-message {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        /* أنماط جديدة لإضافة الصور */
        .image-upload-container {
            margin-bottom: 20px;
        }
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }
        
        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-btn {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        .upload-btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border: 2px dashed #6c757d;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            width: 100%;
        }
        
        .upload-btn:hover {
            border-color: var(--primary);
            background-color: #e9f8f0;
        }
        
        .upload-btn i {
            margin-left: 8px;
            color: var(--primary);
        }
        
        #fileInput {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 20px auto;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .whatsapp-float {
                bottom: 20px;
                left: 20px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <i class="fas fa-lightbulb"></i>
                <h1>سردة نجاح</h1>
                <p>شاركنا النصيحة التي تفيد الآخرين</p>
            </div>
            
            <div id="formSection" class="form-body">
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>كيف تعمل المشاركة؟</strong>
                    <p>يمكنك إرسال نصيحة واحدة فقط يومياً. سيقوم فريقنا بمراجعة جميع النصائح الواردة يوميا واختيار الأفضل منها لنشرها على قناتنا. سيتم نشر النصائح المختارة مع ذكر اسم كاتبها (إذا تم إدخاله). يمكنك إرفاق صورة واحدة مع نصيحتك (اختياري). شكراً لمشاركتك!</p>
                </div>
                
                <div class="form-group">
                    <label for="userName">اسمك (اختياري)</label>
                    <input type="text" id="userName" class="form-control" placeholder="سيتم ذكر اسمك إذا تم اختيار نصيحتك للنشر">
                </div>
                
                <div class="form-group">
                    <label for="tipText">نصيحتك</label>
                    <textarea id="tipText" class="form-control" placeholder="اكتب هنا النصيحة التي تريد مشاركتها معنا..."></textarea>
                </div>
                
                <div class="form-group image-upload-container">
                    <label>إرفاق صورة (اختياري)</label>
                    <input type="file" id="fileInput" accept="image/*">
                    <label for="fileInput" class="upload-btn">
                        <i class="fas fa-image"></i> اختر صورة
                    </label>
                    <div id="imagePreview" class="image-preview"></div>
                </div>
                
                <button id="submitBtn" class="btn" onclick="sendTipToTelegram()">
                    إرسال النصيحة <i class="fas fa-paper-plane"></i>
                </button>
                
                <div id="status"></div>
            </div>
            
            <!-- قسم العداد التنازلي -->
            <div id="countdownSection" class="countdown-container">
                <h2><i class="fas fa-check-circle"></i> تم إرسال نصيحتك بنجاح!</h2>
                <p class="countdown-message">شكراً لمشاركتك. يمكنك إرسال نصيحة جديدة بعد:</p>
                <div id="countdown" class="countdown">24:00:00</div>
                <button class="btn btn-secondary" onclick="closeCountdown()">
                    إغلاق <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
    
    <div class="whatsapp-float">
        <a href="https://whatsapp.com/channel/0029VaNb0u79RZAbQJSLVQ21" class="whatsapp-btn" target="_blank">
            <i class="fab fa-whatsapp"></i>
        </a>
    </div>

    <script>
        // متغير لحفظ الصورة المختارة
        let selectedImage = null;
        
        // عند تحميل الصفحة، نتحقق مما إذا كان المستخدم قد أرسل بالفعل اليوم
        document.addEventListener('DOMContentLoaded', function() {
            checkDailyLimit();
            
            // إعداد معالج اختيار الصورة
            document.getElementById('fileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    // التحقق من أن الملف صورة
                    if (!file.type.match('image.*')) {
                        showStatus('الرجاء اختيار ملف صورة فقط', 'error');
                        return;
                    }
                    
                    // التحقق من حجم الصورة (أقل من 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        showStatus('حجم الصورة يجب أن يكون أقل من 5MB', 'error');
                        return;
                    }
                    
                    selectedImage = file;
                    previewImage(file);
                }
            });
        });

        function previewImage(file) {
            const reader = new FileReader();
            const previewContainer = document.getElementById('imagePreview');
            
            reader.onload = function(e) {
                previewContainer.innerHTML = ''; // مسح أي معاينات سابقة
                
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                
                const img = document.createElement('img');
                img.src = e.target.result;
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.onclick = function() {
                    selectedImage = null;
                    document.getElementById('fileInput').value = '';
                    previewContainer.innerHTML = '';
                };
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                previewContainer.appendChild(previewItem);
            };
            
            reader.readAsDataURL(file);
        }

        function checkDailyLimit() {
            const lastSubmissionDate = localStorage.getItem('lastSubmissionDate');
            const today = new Date().toDateString();
            const submitBtn = document.getElementById('submitBtn');
            const formSection = document.getElementById('formSection');
            const countdownSection = document.getElementById('countdownSection');
            
            if (lastSubmissionDate === today) {
                // إخفاء النموذج وإظهار العداد
                formSection.style.display = 'none';
                countdownSection.style.display = 'block';
                startCountdown();
            }
        }

        function closeCountdown() {
            const formSection = document.getElementById('formSection');
            const countdownSection = document.getElementById('countdownSection');
            
            formSection.style.display = 'block';
            countdownSection.style.display = 'none';
        }

        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            
            // حساب الوقت المتبقي حتى منتصف الليل
            const now = new Date();
            const midnight = new Date();
            midnight.setHours(24, 0, 0, 0);
            
            const diff = midnight - now;
            
            // تحديث العداد كل ثانية
            const countdownInterval = setInterval(() => {
                const now = new Date();
                const diff = midnight - now;
                
                if (diff <= 0) {
                    clearInterval(countdownInterval);
                    countdownElement.textContent = "00:00:00";
                    localStorage.removeItem('lastSubmissionDate');
                    closeCountdown();
                    return;
                }
                
                // تحويل الوقت المتبقي إلى ساعات ودقائق وثواني
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                // عرض الوقت المتبقي بتنسيق HH:MM:SS
                countdownElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        async function sendTipToTelegram() {
            const tipText = document.getElementById('tipText').value.trim();
            const userName = document.getElementById('userName').value.trim();
            const statusElement = document.getElementById('status');
            const submitBtn = document.getElementById('submitBtn');
            const formSection = document.getElementById('formSection');
            const countdownSection = document.getElementById('countdownSection');
            
            // التحقق من آخر تاريخ إرسال
            const lastSubmissionDate = localStorage.getItem('lastSubmissionDate');
            const today = new Date().toDateString();
            
            if (lastSubmissionDate === today) {
                showStatus('لقد قمت بإرسال نصيحة اليوم بالفعل. يمكنك إرسال نصيحة جديدة غداً.', 'warning');
                return;
            }
            
            // إخفاء أي رسالة سابقة
            statusElement.style.display = 'none';
            
            if (!tipText) {
                showStatus('الرجاء إدخال نصيحة قبل الإرسال', 'error');
                return;
            }
            
            showStatus('جاري إرسال النصيحة...', 'loading');
            submitBtn.disabled = true;
            
            try {
                // إعداد نص الرسالة
                let messageText = `📨 <b>نصيحة جديدة</b>\n\n`;
                messageText += `${tipText}\n\n`;
                
                if (userName) {
                    messageText += `من: <b>${userName}</b>`;
                } else {
                    messageText += `من: <b>مستخدم مجهول</b>`;
                }
                
                // إرسال النصيحة إلى بوت Telegram
                const botToken = '7843986073:AAHYaOrepm7ickfzg_NeMB2_F378EwRXZGY';
                const chatId = '5555170485'; // Chat ID الخاص بك
                
                if (selectedImage) {
                    // إذا كانت هناك صورة، نرسلها مع النص
                    const formData = new FormData();
                    formData.append('chat_id', chatId);
                    formData.append('photo', selectedImage);
                    formData.append('caption', messageText);
                    formData.append('parse_mode', 'HTML');
                    
                    const response = await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result.ok) {
                        handleSuccess();
                    } else {
                        throw new Error(result.description || 'خطأ غير معروف');
                    }
                } else {
                    // إذا لم تكن هناك صورة، نرسل النص فقط
                    const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: chatId,
                            text: messageText,
                            parse_mode: 'HTML'
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.ok) {
                        handleSuccess();
                    } else {
                        throw new Error(result.description || 'خطأ غير معروف');
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                showStatus('حدث خطأ في الاتصال. يرجى المحاولة لاحقاً.', 'error');
                submitBtn.disabled = false;
            }
            
            function handleSuccess() {
                // حفظ تاريخ اليوم كتاريخ آخر إرسال
                localStorage.setItem('lastSubmissionDate', today);
                
                // إخفاء النموذج وإظهار العداد
                formSection.style.display = 'none';
                countdownSection.style.display = 'block';
                startCountdown();
                
                // مسح حقول النموذج
                document.getElementById('tipText').value = '';
                document.getElementById('userName').value = '';
                document.getElementById('fileInput').value = '';
                document.getElementById('imagePreview').innerHTML = '';
                selectedImage = null;
            }
        }
        
        function showStatus(message, type) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = type;
            statusElement.style.display = 'block';
        }
    </script>
</body>
</html>